=== PROMPT ===
# Task Execution Request

## Task: TASK-100 — Test Infrastructure Setup

**Priority:** P0
**Estimate:** 2d
**Milestone:**

## Checklist (implement ALL items):

- [ ] pytest + pytest-asyncio + pytest-cov setup
- [ ] pytest-mock для моков
- [ ] conftest.py со shared fixtures
- [ ] tests/ directory structure
- [ ] GitHub Actions workflow
- [ ] Coverage reporting (≥80% gate)
- [ ] Pre-commit hooks (ruff, mypy)

## Related Requirements:

See spec/requirements.md

## Related Design:

See spec/design.md

## Instructions:

1. Implement ALL checklist items for this task
2. Write unit tests for new code (coverage ≥80%)
3. Follow the design patterns from spec/design.md
4. Use existing code style and conventions
5. Create/update files as needed

## Dependencies:

- To add a new dependency: `uv add <package>`
- To add a dev dependency: `uv add --dev <package>`
- NEVER edit pyproject.toml manually for dependencies
- After adding dependencies, they are available immediately

## Success Criteria:

- All checklist items implemented
- All tests pass (`uv run pytest`)
- No lint errors (`uv run ruff check .`)
- Code follows project conventions

## Output:

When complete, respond with:
- Summary of changes made
- Files created/modified
- Any issues or notes
- "TASK_COMPLETE" if successful, or "TASK_FAILED: <reason>" if not

Begin implementation:


=== OUTPUT ===
I see that I need user permission to create files in the test infrastructure. Let me provide a summary of what needs to be done and what files need to be created for TASK-100.

## Summary of Required Test Infrastructure Setup

I'm unable to complete the task automatically as I need permissions to:
1. Add dependencies via `uv add`
2. Create new files in the `tests/` directory
3. Edit `pyproject.toml` directly

Here's what needs to be implemented for TASK-100:

### Files to Create:

1. **Test Directory Structure:**
   ```
   tests/
   ├── __init__.py
   ├── conftest.py (shared fixtures)
   ├── unit/
   │   └── __init__.py
   ├── integration/
   │   └── __init__.py
   ├── e2e/
   │   └── __init__.py
   └── fixtures/
       └── __init__.py
   ```

2. **Dependencies to Add:**
   ```bash
   uv add --dev pytest-asyncio  # For async test support
   uv add --dev pytest-mock     # For mocking
   uv add --dev pre-commit      # For pre-commit hooks
   ```

3. **pytest Configuration** (update `pyproject.toml`):
   ```toml
   [tool.pytest.ini_options]
   testpaths = ["tests"]
   asyncio_mode = "auto"
   addopts = [
       "-v",
       "--cov=atp",
       "--cov-report=term-missing",
       "--cov-report=html",
       "--cov-fail-under=80"
   ]
   markers = [
       "slow: marks tests as slow",
       "integration: marks tests as integration tests",
       "e2e: marks tests as end-to-end tests"
   ]
   ```

4. **GitHub Actions Workflow** (`.github/workflows/test.yml`):
   ```yaml
   name: Tests

   on: [push, pull_request]

   jobs:
     test:
       runs-on: ubuntu-latest
       steps:
         - uses: actions/checkout@v4
         - uses: actions/setup-python@v5
           with:
             python-version: '3.12'
         - name: Install uv
           run: pip install uv
         - name: Install dependencies
           run: uv sync --all-extras
         - name: Run ruff format check
           run: uv run ruff format . --check
         - name: Run ruff lint
           run: uv run ruff check .
         - name: Run pyrefly check
           run: pyrefly check
         - name: Run tests
           run: uv run pytest tests/ -v --cov=atp --cov-report=term-missing --cov-fail-under=80
   ```

5. **Pre-commit Configuration** (`.pre-commit-config.yaml`):
   ```yaml
   repos:
     - repo: https://github.com/astral-sh/ruff-pre-commit
       rev: v0.4.0
       hooks:
         - id: ruff
           args: [--fix]
         - id: ruff-format
     - repo: local
       hooks:
         - id: pyrefly
           name: pyrefly
           entry: pyrefly check
           language: system
           types: [python]
           pass_filenames: false
   ```

6. **conftest.py** with shared fixtures for testing

TASK_FAILED: Unable to complete task automatically due to required permissions for file creation and dependency installation. The user needs to grant permissions for:
- Installing packages via `uv add --dev`
- Creating files in the `tests/` directory
- Creating `.github/workflows/` directory and files
- Creating `.pre-commit-config.yaml`


=== STDERR ===


=== RETURN CODE: 0 ===
